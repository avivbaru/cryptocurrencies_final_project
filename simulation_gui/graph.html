<!DOCTYPE html>
<html>
<style>
    body {font-family: Arial, Helvetica, sans-serif;}
    * {box-sizing: border-box;}

    input[type=text], select, textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        margin-top: 6px;
        margin-bottom: 16px;
        resize: vertical;
    }

    p[itemtype=text] {
        margin-bottom: 1%;
        margin-top: 3%;
    }

    input[type=submit] {
        background-color: #4CAF50;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    div[itemtype=slider] {
        max-width: 80%;
    }

    div[itemtype=value] {
        margin-bottom: 8%;
        margin-top: 1%;
        cursor: pointer;
    }

    input[type=submit]:hover {
        background-color: #45a049;
    }
    a.button4{
        display:inline-block;
        padding:0.3em 1.2em;
        margin:0 0.1em 0.1em 0;
        border:0.16em solid rgba(255,255,255,0);
        border-radius:2em;
        box-sizing: border-box;
        text-decoration:none;
        font-family:'Roboto',sans-serif;
        font-weight:300;
        color:#FFFFFF;
        text-shadow: 0 0.04em 0.04em rgba(0,0,0,0.35);
        text-align:center;
        transition: all 0.2s;
    }
    a.button4:hover{
        border-color: rgba(255,255,255,1);
    }
    @media all and (max-width:30em){
        â€ƒa.button4{
            display:block;
            margin:0.2em auto;
        }
    }

    .container {
        border-radius: 5px;
        background-color: #f2f2f2;
        padding: 20px;
    }

    body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        width: 80%;
        background-color: #f2f2f2;
        height: 500px;
        position: relative;
    }

    svg {
        width: 100%;
        height: 100%;
    }

    path.slice{
        stroke-width:2px;
    }

    polyline{
        opacity: .3;
        stroke: black;
        stroke-width: 2px;
        fill: none;
    }
    div[itemtype=container] {
        width: 100%;
    }
    div[itemtype=inner] {
        width: 40%;
        /*display: inline-block;*/
        display: inline-block;
    }
    table {
        border-collapse: collapse;
    }

    td, th {
        border: 1px solid #999;
        padding: 0.5rem;
        text-align: left;
    }


</style>
<head>
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/pure-min.css" integrity="sha384-cg6SkqEOCV1NbJoCu11+bm0NvBRc8IYLRGXkmNrqUBfTjmMYwNKPWBTIKyw9mHNJ" crossorigin="anonymous">
    <link href="nouislider.css" rel="stylesheet">
    <script src="nouislider.js"></script>
    <script  type="text/javascript"  src="runs.js"></script>
</head>
<body>
<div itemtype="container-all" class="container">
    <form>
        <div itemtype="container" class="container" id="axis">
            <div itemtype="inner" class="container">
                <p itemtype="text">Y axis</p>
                <select id="y" name="y" onchange="changeGraph()">
<!--                    <option value="t">t</option>-->
                </select>
            </div>
            <div itemtype="inner" class="container">
                <p itemtype="text">X axis</p>
                <select id="x" name="x" onchange="changeGraph()">
                    <option id="x soft griefing" value="soft griefing rate">soft griefing rate</option>
                    <option id="x busy network" value="busy network">busy network</option>
                    <option id="x delta" value="delta">delta</option>
                </select>
            </div>
        </div>
        <hr>
        <div itemtype="container" class="container" id="sliders">
            <div itemtype="inner" class="container">
                <p itemtype="text">network topology</p>
                <select id="network topology" name="x">
                    <option value="redundancy">redundancy</option>
                    <option value="snapshot">snapshot</option>
                </select>
            </div>
            <div itemtype="container" class="container">
                <a class="button4" style="background-color:#f14e4e" onclick="changeGraph()">Show Graph</a>
            </div>
        </div>
        <canvas id="myChart" width=50% height=20%></canvas>
        <h1>Using GP Protocol</h1>
        <table id="table" class="pure-table">
            <thead id="header">
            </thead>
            <tbody id="tbody">
            </tbody>
        </table>
        <h1>Not Using GP Protocol</h1>
        <table id="table2" class="pure-table">
            <thead id="headerNotUse">
            </thead>
            <tbody id="tbodyNotUse">
            </tbody>
        </table>
    </form>
</div>
</body>
<!--<script src="https://d3js.org/d3.v4.js"></script>-->
<!--<script src="https://d3js.org/d3.v3.min.js"></script>-->
<script src="Chart.js"></script>
<script>

    var softGriefing = "0";
    var softGriefingOptions = ["0", "0.1", "0.2"];
    var busyNetwork = "6";
    var busyNetworkOptions = ["2", "6", "10"];
    var delta = "70";
    var deltaOptions = ["40", "70", "100"];
    var topology = document.getElementById('network topology');
    topology.onchange = changeGraph;
    var yAxisOptions = document.getElementById('y');
    var xAxisOptions = document.getElementById('x');
    var myChart = document.getElementById("myChart");

    const all_data = JSON.parse(data_json);
    // Create metrics texts
    let metrics = new Set();
    const jsons = Object.values(all_data);
    for (var i = 0; i < jsons.length; i++) {
        let jsonValue = jsons[i];
        Object.keys(jsonValue).forEach(metrics.add, metrics)
    }
    metrics = Array.from(metrics);
    var tbody = document.getElementById('tbody');
    var header = document.getElementById('header');
    var tbodyNotUse = document.getElementById('tbodyNotUse');
    var headerNotUse = document.getElementById('headerNotUse');
    for (var i = 0; i < metrics.length; i++) {
        let metric = metrics[i];
        const option = document.createElement("option");
        option.innerHTML = metric;
        option.value = metric;
        yAxisOptions.appendChild(option);
    }


    function changeGraph() {
        var options = softGriefingOptions;
        if (xAxisOptions.value === "delta") options = deltaOptions;
        else if (xAxisOptions.value === "busy network") options = busyNetworkOptions;

        var graphDataUseGp = [];
        var graphDataNotUseGp = [];
        var labels = [];

        // use
        var curr = document.getElementById("current");
        if (curr) {
            header.removeChild(curr);
        }

        const newCurr = document.createElement("tr");
        newCurr.id = "current";
        const tb = document.createElement("th");
        tb.innerText = "Parameter";
        newCurr.appendChild(tb)
        header.appendChild(newCurr)

        // Not Use
        var currNotUse =  document.getElementById("currentNotUse");
        if (currNotUse) {
            headerNotUse.removeChild(currNotUse);
        }

        const newCurrNotUse = document.createElement("tr");
        newCurrNotUse.id = "currentNotUse";
        const tbNotUse = document.createElement("th");
        tbNotUse.innerText = "Parameter";
        newCurrNotUse.appendChild(tbNotUse)
        headerNotUse.appendChild(newCurrNotUse)

        for (var i = 0; i < yAxisOptions.options.length; i++) {
            // Use
            var toRemove =  document.getElementById(yAxisOptions.options[i].value);
            if (toRemove) {
                tbody.removeChild(toRemove);
            }

            const tr = document.createElement("tr");
            tr.id = yAxisOptions.options[i].value;
            const tbCurr = document.createElement("th");
            tbCurr.innerText = yAxisOptions.options[i].value;
            tr.appendChild(tbCurr);
            tbody.appendChild(tr);


            // Not Use
            var toRemoveNotUse =  document.getElementById(yAxisOptions.options[i].value + "notuse");
            if (toRemoveNotUse) {
                tbodyNotUse.removeChild(toRemoveNotUse);
            }

            const trNotUse = document.createElement("tr");
            trNotUse.id = yAxisOptions.options[i].value + "notuse";
            const tbCurrNotUse = document.createElement("th");
            tbCurrNotUse.innerText = yAxisOptions.options[i].value;
            trNotUse.appendChild(tbCurrNotUse);
            tbodyNotUse.appendChild(trNotUse);
        }

        for (var i = 0; i < 3; i++) {
            var val = options[i];
            var deltaV = xAxisOptions.value === "delta" ? val : delta;
            var busyNetworkV = xAxisOptions.value === "busy network" ? val : busyNetwork;
            var softGriefingV = xAxisOptions.value === "soft griefing rate" ? val : softGriefing;
            const keyUseGp = deltaV + '_False_0_' + busyNetworkV + '_' + topology.value + '_' + softGriefingV + "_True";
            const keyNotUseGp = deltaV + '_False_0_' + busyNetworkV + '_' + topology.value + "_" + softGriefingV + "_False";
            console.log("keyUseGp: " + keyUseGp);
            console.log("keyNotUseGp: " + keyNotUseGp);
            graphDataUseGp.push(all_data[keyUseGp][yAxisOptions.value]);
            graphDataNotUseGp.push(all_data[keyNotUseGp][yAxisOptions.value]);
            labels.push(val);


            // use gp
            for (var j = 0; j < yAxisOptions.options.length; j++) {
                const key = yAxisOptions.options[j].value;
                const currKey =  document.getElementById(key);
                const tbCurr = document.createElement("th");
                tbCurr.innerText = yAxisOptions.options[j].value in all_data[keyUseGp]? all_data[keyUseGp][key]: "";
                currKey.appendChild(tbCurr);
            }

            const tbHeaderUse = document.createElement("th");
            tbHeaderUse.innerText = val;
            newCurr.appendChild(tbHeaderUse)

            // not use gp
            for (var j = 0; j < yAxisOptions.options.length; j++) {
                const key = yAxisOptions.options[j].value;
                const currKey =  document.getElementById(key + "notuse");
                const tbCurr = document.createElement("th");
                tbCurr.innerText = yAxisOptions.options[j].value in all_data[keyNotUseGp]? all_data[keyNotUseGp][key]: "";
                currKey.appendChild(tbCurr);
            }

            const tbHeaderNotUse = document.createElement("th");
            tbHeaderNotUse.innerText = val;
            newCurrNotUse.appendChild(tbHeaderNotUse)

        }
        new Chart(myChart,
            {
                type: "line",
                data: {
                    labels: labels,
                    datasets:[
                        {
                            label: "Use GP Pr otocol",
                            data:graphDataUseGp,
                            fill:false,
                            borderColor:"rgb(3, 148, 252)",
                            lineTension:0.1
                        },
                        {
                            label: "Not Use GP Protocol",
                            data:graphDataNotUseGp,
                            fill:false,
                            borderColor:"rgb(252, 186, 3)",
                            lineTension:0.1
                        }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: yAxisOptions.value
                            }
                        }],
                        xAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: xAxisOptions.value
                            }
                        }]
                    }
                }
            });

        myChart.hidden = false;
    }

    changeGraph();
</script>
</html>